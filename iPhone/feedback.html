<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../FeedBack.css">
    <link rel="stylesheet" href="../CSS.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../themes/Craftzy.min.css" />
    <link rel="stylesheet" href="../themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src=" https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <script>
        let descriptionRating = 0;
        let communicationRating = 0;
        let deliveryRating = 0;

        let data = JSON.parse(sessionStorage.getItem("feedbackData"));
        console.log(data);


        function starClicked(value, ratingItem) {
            switch (value) {
                case 1:
                    document.getElementById(ratingItem + 1).style.color = "orange";
                    document.getElementById(ratingItem + 2).style.color = "#5f6264";
                    document.getElementById(ratingItem + 3).style.color = "#5f6264";
                    document.getElementById(ratingItem + 4).style.color = "#5f6264";
                    document.getElementById(ratingItem + 5).style.color = "#5f6264";
                    break;
                case 2:
                    document.getElementById(ratingItem + 1).style.color = "orange";
                    document.getElementById(ratingItem + 2).style.color = "orange";
                    document.getElementById(ratingItem + 3).style.color = "#5f6264";
                    document.getElementById(ratingItem + 4).style.color = "#5f6264";
                    document.getElementById(ratingItem + 5).style.color = "#5f6264";
                    break;
                case 3:
                    document.getElementById(ratingItem + 1).style.color = "orange";
                    document.getElementById(ratingItem + 2).style.color = "orange";
                    document.getElementById(ratingItem + 3).style.color = "orange";
                    document.getElementById(ratingItem + 4).style.color = "#5f6264";
                    document.getElementById(ratingItem + 5).style.color = "#5f6264";
                    break;
                case 4:
                    document.getElementById(ratingItem + 1).style.color = "orange";
                    document.getElementById(ratingItem + 2).style.color = "orange";
                    document.getElementById(ratingItem + 3).style.color = "orange";
                    document.getElementById(ratingItem + 4).style.color = "orange";
                    document.getElementById(ratingItem + 5).style.color = "#5f6264";
                    break;
                case 5:
                    document.getElementById(ratingItem + 1).style.color = "orange";
                    document.getElementById(ratingItem + 2).style.color = "orange";
                    document.getElementById(ratingItem + 3).style.color = "orange";
                    document.getElementById(ratingItem + 4).style.color = "orange";
                    document.getElementById(ratingItem + 5).style.color = "orange";
                    break;
            }

            switch (ratingItem) {
                case 'star_desc':
                    descriptionRating = value;
                    console.log('hi1 ' + value);
                    break;
                case 'star_comm':
                    communicationRating = value;
                    console.log('hi2 ' + value);
                    break;
                case 'star_delivery':
                    deliveryRating = value;
                    console.log('hi3 ' + value);
                    break;
            }
            console.log(ratingItem + " Rating is : " + value);
        }

        function submitFeedbackClicked() {
            if (communicationRating > 0 && descriptionRating > 0 && deliveryRating > 0) {
                let comment = $.trim($("#textareaFeedback").val());
                var buttonStatus = $('#checkboxCusFeedback').prop('checked');
                console.log(buttonStatus);
                if (buttonStatus === true) {
                    data.userId = 999;
                }
                data.comm_rating = communicationRating;
                data.desc_rating = descriptionRating;
                data.delivery_rating = deliveryRating;
                data.comment = comment;
                console.log(data);

                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState === 4 && this.status === 200) {
                        console.log("hi");
                    }
                };
                xhttp.open("POST", "localhost:9002/KLANmart/feedback", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(JSON.stringify(data));

            } else {
                console.log("validation");
            }


        }
    </script>
</head>

<body>

    <div data-rel="popup">

        <div data-role="content" data-theme="a">
            <div>
                 <h2></h2>SYSTEM FEEDBACK</h2>
                <div style='text-align:center;'>
                    <span class="questionStar">*</span>
                    <span class="question">How accurate was the product description?</span>
                </div>
                <br>
                <div style='text-align:center;'>
                    <div style="text-align: center">
                        <span id="star_desc1" class="fa fa-star starRating" onclick="starClicked(1,'star_desc')"></span>
                        <span id="star_desc2" class="fa fa-star starRating" onclick="starClicked(2,'star_desc')"></span>
                        <span id="star_desc3" class="fa fa-star starRating" onclick="starClicked(3,'star_desc')"></span>
                        <span id="star_desc4" class="fa fa-star starRating" onclick="starClicked(4,'star_desc')"></span>
                        <span id="star_desc5" class="fa fa-star starRating"
                            onclick="starClicked(5,'star_desc')"></span><br>
                    </div>

                </div>
            </div>
            <br><br>
            <div>
                <div style='text-align:center;'>
                    <span class="questionStar">*</span>
                    <span class="question">How satisfied were you with the seller's communication?</span>
                </div>
                <br>
                <div style='text-align:center;'>
                    <div style="text-align: center">
                        <span id="star_comm1" class="fa fa-star starRating" onclick="starClicked(1,'star_comm')"></span>
                        <span id="star_comm2" class="fa fa-star starRating" onclick="starClicked(2,'star_comm')"></span>
                        <span id="star_comm3" class="fa fa-star starRating" onclick="starClicked(3,'star_comm')"></span>
                        <span id="star_comm4" class="fa fa-star starRating" onclick="starClicked(4,'star_comm')"></span>
                        <span id="star_comm5" class="fa fa-star starRating"
                            onclick="starClicked(5,'star_comm')"></span><br>
                    </div>
                </div>
            </div>
            <br><br>
            <div>
                <div style='text-align:center;'>
                    <span class="questionStar">*</span>
                    <span class="question">How quickly did the seller deliver the item?</span>
                </div>
                <br>
                <div style='text-align:center;'>
                    <div style="text-align: center">
                        <span id="star_delivery1" class="fa fa-star starRating"
                            onclick="starClicked(1,'star_delivery')"></span>
                        <span id="star_delivery2" class="fa fa-star starRating"
                            onclick="starClicked(2,'star_delivery')"></span>
                        <span id="star_delivery3" class="fa fa-star starRating"
                            onclick="starClicked(3,'star_delivery')"></span>
                        <span id="star_delivery4" class="fa fa-star starRating"
                            onclick="starClicked(4,'star_delivery')"></span>
                        <span id="star_delivery5" class="fa fa-star starRating"
                            onclick="starClicked(5,'star_delivery')"></span><br>
                    </div>
                </div>
            </div>
            <br>
            <div style="text-align: center" id="feedbackContainerA">
                    <textarea id="textareaFeedback" placeholder="Tell us about what you think ..."></textarea>
                <div id="feedbackContainerB">
                    <input type="checkbox" name="checkboxCusFeedback" id="checkboxCusFeedback" data-mini="true">
                        <label id="lblCheckbox" for="checkboxCusFeedback">Leave Feedback as Anonymous</label>
                    <button onclick="submitFeedbackClicked()" id="submitBtn" class="ui-btn" style="border-radius: 10px;">Submit Feedback</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            /* 1. Visualizing things on Hover - See next part for action on click */
            $('#stars li').on('mouseover', function () {
                var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

                // Now highlight all the stars that's not after the current hovered star
                $(this).parent().children('li.star').each(function (e) {
                    if (e < onStar) {
                        $(this).addClass('hover');
                    }
                    else {
                        $(this).removeClass('hover');
                    }
                });

            }).on('mouseout', function () {
                $(this).parent().children('li.star').each(function (e) {
                    $(this).removeClass('hover');
                });
            });


            /* 2. Action to perform on click */
            $('#stars li').on('click', function () {
                var onStar = parseInt($(this).data('value'), 10); // The star currently selected
                var stars = $(this).parent().children('li.star');

                for (i = 0; i < stars.length; i++) {
                    $(stars[i]).removeClass('selected');
                }

                for (i = 0; i < onStar; i++) {
                    $(stars[i]).addClass('selected');
                }

                // JUST RESPONSE 
                var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
                var msg = "";
                if (ratingValue > 1) {
                    msg = "Thanks! You rated this " + ratingValue + " stars.";
                }
                else {
                    msg = "Thanks! You rated this " + ratingValue + " stars.";
                }
                responseMessage(msg);
                $('#rate').val(ratingValue);
            });


        });


        function responseMessage(msg) {
            $('.success-box').fadeIn(200);
            $('.success-box div.text-message').html("<span>" + msg + "</span>");
        }
    </script>

</body>

</html>