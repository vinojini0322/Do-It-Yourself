<!DOCTYPE html>
<html lang="en">

<head>
    <title>Craftzy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="../themes/Craftzy.min.css">
    <link rel="stylesheet" href="../themes/jquery.mobile.icons.min.css">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css">
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link rel="stylesheet" href="../test-css.css">
    <script>
        $(document).ready(function () {
            $("#select-choice-mini2").change(function () {
                var selectedVal = $("#select-choice-mini2 option:selected").val();
                if (selectedVal === "l2h") {
                    resultArray.sort(function (a, b) { return a.price - b.price });
                } else {
                    resultArray.sort(function (a, b) { return b.price - a.price });
                }

                displayResults();
            });

            $("#select-choice-mini").change(function () {
                var selectedVal = $("#select-choice-mini option:selected").val();
                if (selectedVal === "l2h") {
                    resultArray.sort(function (a, b) { return a.rating - b.rating });
                } else {
                    resultArray.sort(function (a, b) { return b.rating - a.rating });
                }

                displayResults();
            });
        });
    </script>
</head>

<body class="ui-mobile-viewport ui-overlay-a">

    <div data-role="page" style="background-color: #551122">
        <!-- Header -->
        <div data-role="header" role="banner" class="ui-header ui-bar-inherit">

            <div class="ui-grid-b">
                <div class="ui-block-a" style="width: 15%;">

                    <div class="ui-bar ui-bar-a"><img src="../images/logo1.png"></div>

                </div>

                <div class="ui-block-b" style="width:73%; margin: auto; color:red;">
                    <div class="ui-bar ui-bar-a" style="color:red;">

                        <form class="ui-filterable" style="background-color:#dddddd8f;border-radius: 12px;">
                            <input name="search" id="filterBasic-input" data-type="search" />
                    </div>
                </div>

                <div class="ui-block-c" style="width: 10%; margin-top: 6px;  position: relative;">
                    <div class="QRStyle">
                        <a target="_self" href="Offers.html" class="ui-link"> <img class="QRStyle"
                                src="../icons/icon-QRAR.png"> </a>
                    </div>
                </div>
            </div>
        </div>
        <div>

            <div id="itemContainer" class="ui-body ui-body-a ui-corner-all" style="  width:75%; height:min-content;"
                onclick="savePoints()">
            </div>

            <div data-role="footer" data-position="fixed">
                <nav data-role="navbar">
                    <ul class="ui-grid-d">
                        <li class="ui-block-a"><a target="_self" href="Home.html" data-icon="icons-home" data-theme="a"
                                data-transition="slide">Home</a></li>
                        <li class="ui-block-b"><a target="_self" href="Categories.html" data-icon="icons-category"
                                data-theme="a" data-transition="slide">Category</a>
                        </li>
                        <li class="ui-block-c"><a target="_self" href="MyCart.html" data-icon="icons-cart"
                                data-theme="a" data-transition="slide">Cart</a></li>
                        <li class="ui-block-d"><a target="_self" href="Game.html" data-icon="icons-game" data-theme="a"
                                data-transition="slide">Game</a></li>
                        <li class="ui-block-e"><a target="_self" href="MyProfile_Customer.html"
                                data-icon="icons-profile" data-theme="a" data-transition="slide">Profile</a></li>

                    </ul>
                </nav>
            </div>

        </div>
        <script>
            function goToHome() {
                document.location.href = "./home.html";
            }
            function savePoints() {
                $("#faillogin").popup("open");
            }

            function selectItem(itemId) {
                console.log(itemId);
                var products = JSON.parse(localStorage.getItem('products'));
                $.each(products, function (i, item) {
                    if (item.id == itemId) {
                        console.log('here2');
                        item.isSelected = true;
                    }
                });
                localStorage.setItem('products', JSON.stringify(products));
                window.location = './ViewItem.html'
            }

            function displayResults() {
                let resultArray = localStorage.getItem('products');
                resultArray = JSON.parse(resultArray);
                let discount = parseInt(localStorage.getItem('points'))
                document.getElementById("itemContainer").innerHTML = "";
                for (let i = 0; i < resultArray.length; i++) {
                    let price = parseInt(resultArray[i].price);
                    price = price - (price * discount / 100);
                    resultArray[i]['discountPrice'] = price;
                    var content = `
                    <div class="item" style="background-color: white;
    width: inherit;
    margin-left: 59px;
    border-radius: 54px;
    height: -webkit-fill-available;" onclick="selectItem(${resultArray[i].id})">
                    <img src="${resultArray[i].picUrl}" width="120px" height="100px" class="item-image" style="padding-top: 20px;">
                    <div class="item-description">
                        <p class="product-name" style="text-align: center;font-family: serif !important; 
    font-size:26px;
    font-weight: bold;
    color: #000;
    padding-left: 20px;">${resultArray[i].short_discription}</p>
                 <i class="fas fa-tags"></i>
                        <p class="price-tag" style="text-align: center;font-family: serif !important;
    font-size: 24px;
    font-weight: bold;
    color: rgb(53, 53, 53);
    padding-left: 20px;">LKR ${price}.00</p> <br>
                        <p class="shiping-details" style="text-align: center;font-family: serif !important;
    font-size: 20px;
    font-weight: normal;
    color: rgb(102, 100, 100);
    padding-left: 20px;
    margin-top: -27px;">Free Shipping</p>
                        <div class="rating" style="text-align: center;font-family: serif !important;
    font-size: 20px;
    font-weight: normal;
    color: rgb(102, 100, 100);
    padding-left: 20px;
    ">${resultArray[i].rating}</div>
                        <i class="fas fa-star"></i>
                        
                    </div>
                    
                </div>
                <br>
                        <br>`;

                    document.getElementById("itemContainer").innerHTML += content;
                }
                console.log('here', resultArray);
                localStorage.setItem('products', JSON.stringify(resultArray));
            }
            displayResults();

        </script>

</body>

</html>